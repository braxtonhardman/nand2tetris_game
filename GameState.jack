class GameState { 

    field Player player1; 
    field Player player2; 
    field Ball currentBall;
    field Input input; 
    field int turn, powerX, powerY; 
    field RoomLayout room; 

    constructor GameState new(Player p1, Player p2, RoomLayout r) { 
        let player1 = p1;
        let player2 = p2; 
        let room = r; 
        let turn = 0; 
        let currentBall = null;
        let input = Input.new(player1.getName(), player2.getName());
        return this;
    }

    method void run() { 
        var boolean running; 
        var boolean colliding; 
        var Player curPlayer;
        var int x, y, i; 
        let running = true; 
        let colliding = false; 
         

        while(running) { 
            let curPlayer = getCurrentPlayer(); 
            let x = curPlayer.getX(); 
            let y = curPlayer.getY(); 
            let i = 0; 


            do input.runTurn(curPlayer.getName()); 
            let powerX = input.getPowerX();
            let powerY = input.getPowerY(); 
            
            
             // x, y, xpow, ypow
            let currentBall = Ball.new(x, y, powerX, powerY); 

            while(~ (colliding)) { 

                do currentBall.clearBall();
                do update(currentBall); 
                do draw(); 

                while(i < 30000) { 
                    let i = i + 1; 
                }

                let i = 0; 
            }

            
        }

        return; 
    }

    // Launch the ball and draw the ball 
    method void update(Ball currentBall) {        
        do currentBall.move(); 
        return; 
    }

    method Player getPlayer(int playerNum) { 
        if(playerNum = 1) { 
            return player1;
        } else { 
            return player2; 
        }
    }

    method Player getCurrentPlayer() { 
        if(turn = 0) { 
            return player1;
        } else { 
            return player2; 
        }
    }
    method String getCurrentPlayerName() { 
        if(turn = 0) { 
            return player1.getName(); 
        } else { 
            return player2.getName();
        }
    }

    method void draw()
    {
        //Draw each of our objects by calling their draw function
        do player1.draw();
        do player2.draw();
        do room.draw(); 
        do currentBall.draw();
        return;
    }
}